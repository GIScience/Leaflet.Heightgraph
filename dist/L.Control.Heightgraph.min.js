!function(){"use strict";function t(n){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}function n(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function e(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return s=t.done,t},e:function(t){l=!0,a=t},f:function(){try{s||null==i.return||i.return()}finally{if(l)throw a}}}}var i="http://www.w3.org/1999/xhtml",r={svg:"http://www.w3.org/2000/svg",xhtml:i,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function o(t){var n=t+="",e=n.indexOf(":");return e>=0&&"xmlns"!==(n=t.slice(0,e))&&(t=t.slice(e+1)),r.hasOwnProperty(n)?{space:r[n],local:t}:t}function a(t){return function(){var n=this.ownerDocument,e=this.namespaceURI;return e===i&&n.documentElement.namespaceURI===i?n.createElement(t):n.createElementNS(e,t)}}function s(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function l(t){var n=o(t);return(n.local?s:a)(n)}function u(){}function h(t){return null==t?u:function(){return this.querySelector(t)}}function c(){return[]}function f(t){return new Array(t.length)}function p(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}p.prototype={constructor:p,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function d(t,n,e,i,r,o){for(var a,s=0,l=n.length,u=o.length;s<u;++s)(a=n[s])?(a.__data__=o[s],i[s]=a):e[s]=new p(t,o[s]);for(;s<l;++s)(a=n[s])&&(r[s]=a)}function g(t,n,e,i,r,o,a){var s,l,u,h={},c=n.length,f=o.length,d=new Array(c);for(s=0;s<c;++s)(l=n[s])&&(d[s]=u="$"+a.call(l,l.__data__,s,n),u in h?r[s]=l:h[u]=l);for(s=0;s<f;++s)(l=h[u="$"+a.call(t,o[s],s,o)])?(i[s]=l,l.__data__=o[s],h[u]=null):e[s]=new p(t,o[s]);for(s=0;s<c;++s)(l=n[s])&&h[d[s]]===l&&(r[s]=l)}function _(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}function m(t){return function(){this.removeAttribute(t)}}function y(t){return function(){this.removeAttributeNS(t.space,t.local)}}function v(t,n){return function(){this.setAttribute(t,n)}}function x(t,n){return function(){this.setAttributeNS(t.space,t.local,n)}}function b(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttribute(t):this.setAttribute(t,e)}}function w(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}}function k(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function M(t){return function(){this.style.removeProperty(t)}}function S(t,n,e){return function(){this.style.setProperty(t,n,e)}}function A(t,n,e){return function(){var i=n.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,e)}}function T(t,n){return t.style.getPropertyValue(n)||k(t).getComputedStyle(t,null).getPropertyValue(n)}function E(t){return function(){delete this[t]}}function N(t,n){return function(){this[t]=n}}function C(t,n){return function(){var e=n.apply(this,arguments);null==e?delete this[t]:this[t]=e}}function H(t){return t.trim().split(/^|\s+/)}function D(t){return t.classList||new F(t)}function F(t){this._node=t,this._names=H(t.getAttribute("class")||"")}function z(t,n){for(var e=D(t),i=-1,r=n.length;++i<r;)e.add(n[i])}function O(t,n){for(var e=D(t),i=-1,r=n.length;++i<r;)e.remove(n[i])}function B(t){return function(){z(this,t)}}function P(t){return function(){O(this,t)}}function R(t,n){return function(){(n.apply(this,arguments)?z:O)(this,t)}}function q(){this.textContent=""}function $(t){return function(){this.textContent=t}}function j(t){return function(){var n=t.apply(this,arguments);this.textContent=null==n?"":n}}function I(){this.innerHTML=""}function G(t){return function(){this.innerHTML=t}}function V(t){return function(){var n=t.apply(this,arguments);this.innerHTML=null==n?"":n}}function U(){this.nextSibling&&this.parentNode.appendChild(this)}function X(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Y(){return null}function W(){var t=this.parentNode;t&&t.removeChild(this)}function Z(){var t=this.cloneNode(!1),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function Q(){var t=this.cloneNode(!0),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}F.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var n=this._names.indexOf(t);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var K={},J=null;"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(K={mouseenter:"mouseover",mouseleave:"mouseout"}));function tt(t,n,e){return t=nt(t,n,e),function(n){var e=n.relatedTarget;e&&(e===this||8&e.compareDocumentPosition(this))||t.call(this,n)}}function nt(t,n,e){return function(i){var r=J;J=i;try{t.call(this,this.__data__,n,e)}finally{J=r}}}function et(t){return t.trim().split(/^|\s+/).map((function(t){var n="",e=t.indexOf(".");return e>=0&&(n=t.slice(e+1),t=t.slice(0,e)),{type:t,name:n}}))}function it(t){return function(){var n=this.__on;if(n){for(var e,i=0,r=-1,o=n.length;i<o;++i)e=n[i],t.type&&e.type!==t.type||e.name!==t.name?n[++r]=e:this.removeEventListener(e.type,e.listener,e.capture);++r?n.length=r:delete this.__on}}}function rt(t,n,e){var i=K.hasOwnProperty(t.type)?tt:nt;return function(r,o,a){var s,l=this.__on,u=i(n,o,a);if(l)for(var h=0,c=l.length;h<c;++h)if((s=l[h]).type===t.type&&s.name===t.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=u,s.capture=e),void(s.value=n);this.addEventListener(t.type,u,e),s={type:t.type,name:t.name,value:n,listener:u,capture:e},l?l.push(s):this.__on=[s]}}function ot(t,n,e,i){var r=J;t.sourceEvent=J,J=t;try{return n.apply(e,i)}finally{J=r}}function at(t,n,e){var i=k(t),r=i.CustomEvent;"function"==typeof r?r=new r(n,e):(r=i.document.createEvent("Event"),e?(r.initEvent(n,e.bubbles,e.cancelable),r.detail=e.detail):r.initEvent(n,!1,!1)),t.dispatchEvent(r)}function st(t,n){return function(){return at(this,t,n)}}function lt(t,n){return function(){return at(this,t,n.apply(this,arguments))}}var ut=[null];function ht(t,n){this._groups=t,this._parents=n}function ct(t){return"string"==typeof t?new ht([[document.querySelector(t)]],[document.documentElement]):new ht([[t]],ut)}function ft(){for(var t,n=J;t=n.sourceEvent;)n=t;return n}function pt(t,n){var e=t.ownerSVGElement||t;if(e.createSVGPoint){var i=e.createSVGPoint();return i.x=n.clientX,i.y=n.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}var r=t.getBoundingClientRect();return[n.clientX-r.left-t.clientLeft,n.clientY-r.top-t.clientTop]}function dt(t){var n=ft();return n.changedTouches&&(n=n.changedTouches[0]),pt(t,n)}function gt(t){return"string"==typeof t?new ht([document.querySelectorAll(t)],[document.documentElement]):new ht([null==t?[]:t],ut)}function _t(t,n,e){arguments.length<3&&(e=n,n=ft().changedTouches);for(var i,r=0,o=n?n.length:0;r<o;++r)if((i=n[r]).identifier===e)return pt(t,i);return null}function mt(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}function yt(t){var n;return 1===t.length&&(n=t,t=function(t,e){return mt(n(t),e)}),{left:function(n,e,i,r){for(null==i&&(i=0),null==r&&(r=n.length);i<r;){var o=i+r>>>1;t(n[o],e)<0?i=o+1:r=o}return i},right:function(n,e,i,r){for(null==i&&(i=0),null==r&&(r=n.length);i<r;){var o=i+r>>>1;t(n[o],e)>0?r=o:i=o+1}return i}}}ht.prototype=function(){return new ht([[document.documentElement]],ut)}.prototype={constructor:ht,select:function(t){"function"!=typeof t&&(t=h(t));for(var n=this._groups,e=n.length,i=new Array(e),r=0;r<e;++r)for(var o,a,s=n[r],l=s.length,u=i[r]=new Array(l),c=0;c<l;++c)(o=s[c])&&(a=t.call(o,o.__data__,c,s))&&("__data__"in o&&(a.__data__=o.__data__),u[c]=a);return new ht(i,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=function(t){return null==t?c:function(){return this.querySelectorAll(t)}}(t));for(var n=this._groups,e=n.length,i=[],r=[],o=0;o<e;++o)for(var a,s=n[o],l=s.length,u=0;u<l;++u)(a=s[u])&&(i.push(t.call(a,a.__data__,u,s)),r.push(a));return new ht(i,r)},filter:function(t){"function"!=typeof t&&(t=function(t){return function(){return this.matches(t)}}(t));for(var n=this._groups,e=n.length,i=new Array(e),r=0;r<e;++r)for(var o,a=n[r],s=a.length,l=i[r]=[],u=0;u<s;++u)(o=a[u])&&t.call(o,o.__data__,u,a)&&l.push(o);return new ht(i,this._parents)},data:function(t,n){if(!t)return p=new Array(this.size()),u=-1,this.each((function(t){p[++u]=t})),p;var e=n?g:d,i=this._parents,r=this._groups;"function"!=typeof t&&(t=function(t){return function(){return t}}(t));for(var o=r.length,a=new Array(o),s=new Array(o),l=new Array(o),u=0;u<o;++u){var h=i[u],c=r[u],f=c.length,p=t.call(h,h&&h.__data__,u,i),_=p.length,m=s[u]=new Array(_),y=a[u]=new Array(_);e(h,c,m,y,l[u]=new Array(f),p,n);for(var v,x,b=0,w=0;b<_;++b)if(v=m[b]){for(b>=w&&(w=b+1);!(x=y[w])&&++w<_;);v._next=x||null}}return(a=new ht(a,i))._enter=s,a._exit=l,a},enter:function(){return new ht(this._enter||this._groups.map(f),this._parents)},exit:function(){return new ht(this._exit||this._groups.map(f),this._parents)},join:function(t,n,e){var i=this.enter(),r=this,o=this.exit();return i="function"==typeof t?t(i):i.append(t+""),null!=n&&(r=n(r)),null==e?o.remove():e(o),i&&r?i.merge(r).order():r},merge:function(t){for(var n=this._groups,e=t._groups,i=n.length,r=e.length,o=Math.min(i,r),a=new Array(i),s=0;s<o;++s)for(var l,u=n[s],h=e[s],c=u.length,f=a[s]=new Array(c),p=0;p<c;++p)(l=u[p]||h[p])&&(f[p]=l);for(;s<i;++s)a[s]=n[s];return new ht(a,this._parents)},order:function(){for(var t=this._groups,n=-1,e=t.length;++n<e;)for(var i,r=t[n],o=r.length-1,a=r[o];--o>=0;)(i=r[o])&&(a&&4^i.compareDocumentPosition(a)&&a.parentNode.insertBefore(i,a),a=i);return this},sort:function(t){function n(n,e){return n&&e?t(n.__data__,e.__data__):!n-!e}t||(t=_);for(var e=this._groups,i=e.length,r=new Array(i),o=0;o<i;++o){for(var a,s=e[o],l=s.length,u=r[o]=new Array(l),h=0;h<l;++h)(a=s[h])&&(u[h]=a);u.sort(n)}return new ht(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),n=-1;return this.each((function(){t[++n]=this})),t},node:function(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var i=t[n],r=0,o=i.length;r<o;++r){var a=i[r];if(a)return a}return null},size:function(){var t=0;return this.each((function(){++t})),t},empty:function(){return!this.node()},each:function(t){for(var n=this._groups,e=0,i=n.length;e<i;++e)for(var r,o=n[e],a=0,s=o.length;a<s;++a)(r=o[a])&&t.call(r,r.__data__,a,o);return this},attr:function(t,n){var e=o(t);if(arguments.length<2){var i=this.node();return e.local?i.getAttributeNS(e.space,e.local):i.getAttribute(e)}return this.each((null==n?e.local?y:m:"function"==typeof n?e.local?w:b:e.local?x:v)(e,n))},style:function(t,n,e){return arguments.length>1?this.each((null==n?M:"function"==typeof n?A:S)(t,n,null==e?"":e)):T(this.node(),t)},property:function(t,n){return arguments.length>1?this.each((null==n?E:"function"==typeof n?C:N)(t,n)):this.node()[t]},classed:function(t,n){var e=H(t+"");if(arguments.length<2){for(var i=D(this.node()),r=-1,o=e.length;++r<o;)if(!i.contains(e[r]))return!1;return!0}return this.each(("function"==typeof n?R:n?B:P)(e,n))},text:function(t){return arguments.length?this.each(null==t?q:("function"==typeof t?j:$)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?I:("function"==typeof t?V:G)(t)):this.node().innerHTML},raise:function(){return this.each(U)},lower:function(){return this.each(X)},append:function(t){var n="function"==typeof t?t:l(t);return this.select((function(){return this.appendChild(n.apply(this,arguments))}))},insert:function(t,n){var e="function"==typeof t?t:l(t),i=null==n?Y:"function"==typeof n?n:h(n);return this.select((function(){return this.insertBefore(e.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(W)},clone:function(t){return this.select(t?Q:Z)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,n,e){var i,r,o=et(t+""),a=o.length;if(!(arguments.length<2)){for(s=n?rt:it,null==e&&(e=!1),i=0;i<a;++i)this.each(s(o[i],n,e));return this}var s=this.node().__on;if(s)for(var l,u=0,h=s.length;u<h;++u)for(i=0,l=s[u];i<a;++i)if((r=o[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,n){return this.each(("function"==typeof n?lt:st)(t,n))}};var vt=yt(mt).right;function xt(t){return null===t?NaN:+t}var bt=Math.sqrt(50),wt=Math.sqrt(10),kt=Math.sqrt(2);function Mt(t,n,e){var i=(n-t)/Math.max(0,e),r=Math.floor(Math.log(i)/Math.LN10),o=i/Math.pow(10,r);return r>=0?(o>=bt?10:o>=wt?5:o>=kt?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(o>=bt?10:o>=wt?5:o>=kt?2:1)}function St(t,n){var e,i,r=t.length,o=-1;if(null==n){for(;++o<r;)if(null!=(e=t[o])&&e>=e)for(i=e;++o<r;)null!=(e=t[o])&&e>i&&(i=e)}else for(;++o<r;)if(null!=(e=n(t[o],o,t))&&e>=e)for(i=e;++o<r;)null!=(e=n(t[o],o,t))&&e>i&&(i=e);return i}function At(t,n){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(n).domain(t)}return this}function Tt(){}function Et(t,n){var e=new Tt;if(t instanceof Tt)t.each((function(t,n){e.set(n,t)}));else if(Array.isArray(t)){var i,r=-1,o=t.length;if(null==n)for(;++r<o;)e.set(r,t[r]);else for(;++r<o;)e.set(n(i=t[r],r,t),i)}else if(t)for(var a in t)e.set(a,t[a]);return e}function Nt(){}Tt.prototype=Et.prototype={constructor:Tt,has:function(t){return"$"+t in this},get:function(t){return this["$"+t]},set:function(t,n){return this["$"+t]=n,this},remove:function(t){var n="$"+t;return n in this&&delete this[n]},clear:function(){for(var t in this)"$"===t[0]&&delete this[t]},keys:function(){var t=[];for(var n in this)"$"===n[0]&&t.push(n.slice(1));return t},values:function(){var t=[];for(var n in this)"$"===n[0]&&t.push(this[n]);return t},entries:function(){var t=[];for(var n in this)"$"===n[0]&&t.push({key:n.slice(1),value:this[n]});return t},size:function(){var t=0;for(var n in this)"$"===n[0]&&++t;return t},empty:function(){for(var t in this)if("$"===t[0])return!1;return!0},each:function(t){for(var n in this)"$"===n[0]&&t(this[n],n.slice(1),this)}};var Ct=Et.prototype;Nt.prototype=function(t,n){var e=new Nt;if(t instanceof Nt)t.each((function(t){e.add(t)}));else if(t){var i=-1,r=t.length;if(null==n)for(;++i<r;)e.add(t[i]);else for(;++i<r;)e.add(n(t[i],i,t))}return e}.prototype={constructor:Nt,has:Ct.has,add:function(t){return this["$"+(t+="")]=t,this},remove:Ct.remove,clear:Ct.clear,values:Ct.keys,size:Ct.size,empty:Ct.empty,each:Ct.each};var Lt=Array.prototype,Ht=Lt.map,Dt=Lt.slice,Ft={name:"implicit"};function zt(t,n,e){t.prototype=n.prototype=e,e.constructor=t}function Ot(t,n){var e=Object.create(t.prototype);for(var i in n)e[i]=n[i];return e}function Bt(){}var Pt="\\s*([+-]?\\d+)\\s*",Rt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",qt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",$t=/^#([0-9a-f]{3,8})$/,jt=new RegExp("^rgb\\("+[Pt,Pt,Pt]+"\\)$"),It=new RegExp("^rgb\\("+[qt,qt,qt]+"\\)$"),Gt=new RegExp("^rgba\\("+[Pt,Pt,Pt,Rt]+"\\)$"),Vt=new RegExp("^rgba\\("+[qt,qt,qt,Rt]+"\\)$"),Ut=new RegExp("^hsl\\("+[Rt,qt,qt]+"\\)$"),Xt=new RegExp("^hsla\\("+[Rt,qt,qt,Rt]+"\\)$"),Yt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Wt(){return this.rgb().formatHex()}function Zt(){return this.rgb().formatRgb()}function Qt(t){var n,e;return t=(t+"").trim().toLowerCase(),(n=$t.exec(t))?(e=n[1].length,n=parseInt(n[1],16),6===e?Kt(n):3===e?new en(n>>8&15|n>>4&240,n>>4&15|240&n,(15&n)<<4|15&n,1):8===e?Jt(n>>24&255,n>>16&255,n>>8&255,(255&n)/255):4===e?Jt(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|240&n,((15&n)<<4|15&n)/255):null):(n=jt.exec(t))?new en(n[1],n[2],n[3],1):(n=It.exec(t))?new en(255*n[1]/100,255*n[2]/100,255*n[3]/100,1):(n=Gt.exec(t))?Jt(n[1],n[2],n[3],n[4]):(n=Vt.exec(t))?Jt(255*n[1]/100,255*n[2]/100,255*n[3]/100,n[4]):(n=Ut.exec(t))?sn(n[1],n[2]/100,n[3]/100,1):(n=Xt.exec(t))?sn(n[1],n[2]/100,n[3]/100,n[4]):Yt.hasOwnProperty(t)?Kt(Yt[t]):"transparent"===t?new en(NaN,NaN,NaN,0):null}function Kt(t){return new en(t>>16&255,t>>8&255,255&t,1)}function Jt(t,n,e,i){return i<=0&&(t=n=e=NaN),new en(t,n,e,i)}function tn(t){return t instanceof Bt||(t=Qt(t)),t?new en((t=t.rgb()).r,t.g,t.b,t.opacity):new en}function nn(t,n,e,i){return 1===arguments.length?tn(t):new en(t,n,e,null==i?1:i)}function en(t,n,e,i){this.r=+t,this.g=+n,this.b=+e,this.opacity=+i}function rn(){return"#"+an(this.r)+an(this.g)+an(this.b)}function on(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function an(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function sn(t,n,e,i){return i<=0?t=n=e=NaN:e<=0||e>=1?t=n=NaN:n<=0&&(t=NaN),new un(t,n,e,i)}function ln(t){if(t instanceof un)return new un(t.h,t.s,t.l,t.opacity);if(t instanceof Bt||(t=Qt(t)),!t)return new un;if(t instanceof un)return t;var n=(t=t.rgb()).r/255,e=t.g/255,i=t.b/255,r=Math.min(n,e,i),o=Math.max(n,e,i),a=NaN,s=o-r,l=(o+r)/2;return s?(a=n===o?(e-i)/s+6*(e<i):e===o?(i-n)/s+2:(n-e)/s+4,s/=l<.5?o+r:2-o-r,a*=60):s=l>0&&l<1?0:a,new un(a,s,l,t.opacity)}function un(t,n,e,i){this.h=+t,this.s=+n,this.l=+e,this.opacity=+i}function hn(t,n,e){return 255*(t<60?n+(e-n)*t/60:t<180?e:t<240?n+(e-n)*(240-t)/60:n)}function cn(t){return function(){return t}}function fn(t){return 1==(t=+t)?pn:function(n,e){return e-n?function(t,n,e){return t=Math.pow(t,e),n=Math.pow(n,e)-t,e=1/e,function(i){return Math.pow(t+i*n,e)}}(n,e,t):cn(isNaN(n)?e:n)}}function pn(t,n){var e=n-t;return e?function(t,n){return function(e){return t+e*n}}(t,e):cn(isNaN(t)?n:t)}zt(Bt,Qt,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Wt,formatHex:Wt,formatHsl:function(){return ln(this).formatHsl()},formatRgb:Zt,toString:Zt}),zt(en,nn,Ot(Bt,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new en(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new en(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rn,formatHex:rn,formatRgb:on,toString:on})),zt(un,(function(t,n,e,i){return 1===arguments.length?ln(t):new un(t,n,e,null==i?1:i)}),Ot(Bt,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new un(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new un(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),n=isNaN(t)||isNaN(this.s)?0:this.s,e=this.l,i=e+(e<.5?e:1-e)*n,r=2*e-i;return new en(hn(t>=240?t-240:t+120,r,i),hn(t,r,i),hn(t<120?t+240:t-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var dn=function t(n){var e=fn(n);function i(t,n){var i=e((t=nn(t)).r,(n=nn(n)).r),r=e(t.g,n.g),o=e(t.b,n.b),a=pn(t.opacity,n.opacity);return function(n){return t.r=i(n),t.g=r(n),t.b=o(n),t.opacity=a(n),t+""}}return i.gamma=t,i}(1);function gn(t,n){n||(n=[]);var e,i=t?Math.min(n.length,t.length):0,r=n.slice();return function(o){for(e=0;e<i;++e)r[e]=t[e]*(1-o)+n[e]*o;return r}}function _n(t,n){var e,i=n?n.length:0,r=t?Math.min(i,t.length):0,o=new Array(r),a=new Array(i);for(e=0;e<r;++e)o[e]=kn(t[e],n[e]);for(;e<i;++e)a[e]=n[e];return function(t){for(e=0;e<r;++e)a[e]=o[e](t);return a}}function mn(t,n){var e=new Date;return t=+t,n=+n,function(i){return e.setTime(t*(1-i)+n*i),e}}function yn(t,n){return t=+t,n=+n,function(e){return t*(1-e)+n*e}}function vn(t,n){var e,i={},r={};for(e in null!==t&&"object"==typeof t||(t={}),null!==n&&"object"==typeof n||(n={}),n)e in t?i[e]=kn(t[e],n[e]):r[e]=n[e];return function(t){for(e in i)r[e]=i[e](t);return r}}var xn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,bn=new RegExp(xn.source,"g");function wn(t,n){var e,i,r,o=xn.lastIndex=bn.lastIndex=0,a=-1,s=[],l=[];for(t+="",n+="";(e=xn.exec(t))&&(i=bn.exec(n));)(r=i.index)>o&&(r=n.slice(o,r),s[a]?s[a]+=r:s[++a]=r),(e=e[0])===(i=i[0])?s[a]?s[a]+=i:s[++a]=i:(s[++a]=null,l.push({i:a,x:yn(e,i)})),o=bn.lastIndex;return o<n.length&&(r=n.slice(o),s[a]?s[a]+=r:s[++a]=r),s.length<2?l[0]?function(t){return function(n){return t(n)+""}}(l[0].x):function(t){return function(){return t}}(n):(n=l.length,function(t){for(var e,i=0;i<n;++i)s[(e=l[i]).i]=e.x(t);return s.join("")})}function kn(t,n){var e,i=typeof n;return null==n||"boolean"===i?cn(n):("number"===i?yn:"string"===i?(e=Qt(n))?(n=e,dn):wn:n instanceof Qt?dn:n instanceof Date?mn:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}(n)?gn:Array.isArray(n)?_n:"function"!=typeof n.valueOf&&"function"!=typeof n.toString||isNaN(n)?vn:yn)(t,n)}function Mn(t,n){return t=+t,n=+n,function(e){return Math.round(t*(1-e)+n*e)}}function Sn(t){return+t}var An=[0,1];function Tn(t){return t}function En(t,n){return(n-=t=+t)?function(e){return(e-t)/n}:function(t){return function(){return t}}(isNaN(n)?NaN:.5)}function Nn(t){var n,e=t[0],i=t[t.length-1];return e>i&&(n=e,e=i,i=n),function(t){return Math.max(e,Math.min(i,t))}}function Cn(t,n,e){var i=t[0],r=t[1],o=n[0],a=n[1];return r<i?(i=En(r,i),o=e(a,o)):(i=En(i,r),o=e(o,a)),function(t){return o(i(t))}}function Ln(t,n,e){var i=Math.min(t.length,n.length)-1,r=new Array(i),o=new Array(i),a=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),n=n.slice().reverse());++a<i;)r[a]=En(t[a],t[a+1]),o[a]=e(n[a],n[a+1]);return function(n){var e=vt(t,n,1,i)-1;return o[e](r[e](n))}}function Hn(t,n){return n.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Dn(t,n){return function(){var t,n,e,i,r,o,a=An,s=An,l=kn,u=Tn;function h(){return i=Math.min(a.length,s.length)>2?Ln:Cn,r=o=null,c}function c(n){return isNaN(n=+n)?e:(r||(r=i(a.map(t),s,l)))(t(u(n)))}return c.invert=function(e){return u(n((o||(o=i(s,a.map(t),yn)))(e)))},c.domain=function(t){return arguments.length?(a=Ht.call(t,Sn),u===Tn||(u=Nn(a)),h()):a.slice()},c.range=function(t){return arguments.length?(s=Dt.call(t),h()):s.slice()},c.rangeRound=function(t){return s=Dt.call(t),l=Mn,h()},c.clamp=function(t){return arguments.length?(u=t?Nn(a):Tn,c):u!==Tn},c.interpolate=function(t){return arguments.length?(l=t,h()):l},c.unknown=function(t){return arguments.length?(e=t,c):e},function(e,i){return t=e,n=i,h()}}()(t,n)}function Fn(t,n){if((e=(t=n?t.toExponential(n-1):t.toExponential()).indexOf("e"))<0)return null;var e,i=t.slice(0,e);return[i.length>1?i[0]+i.slice(2):i,+t.slice(e+1)]}function zn(t){return(t=Fn(Math.abs(t)))?t[1]:NaN}var On,Bn=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Pn(t){if(!(n=Bn.exec(t)))throw new Error("invalid format: "+t);var n;return new Rn({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}function Rn(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function qn(t,n){var e=Fn(t,n);if(!e)return t+"";var i=e[0],r=e[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}Pn.prototype=Rn.prototype,Rn.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var $n={"%":function(t,n){return(100*t).toFixed(n)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,n){return t.toExponential(n)},f:function(t,n){return t.toFixed(n)},g:function(t,n){return t.toPrecision(n)},o:function(t){return Math.round(t).toString(8)},p:function(t,n){return qn(100*t,n)},r:qn,s:function(t,n){var e=Fn(t,n);if(!e)return t+"";var i=e[0],r=e[1],o=r-(On=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,a=i.length;return o===a?i:o>a?i+new Array(o-a+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+Fn(t,Math.max(0,n+o-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function jn(t){return t}var In,Gn,Vn,Un=Array.prototype.map,Xn=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Yn(t){var n,e,i=void 0===t.grouping||void 0===t.thousands?jn:(n=Un.call(t.grouping,Number),e=t.thousands+"",function(t,i){for(var r=t.length,o=[],a=0,s=n[0],l=0;r>0&&s>0&&(l+s+1>i&&(s=Math.max(1,i-l)),o.push(t.substring(r-=s,r+s)),!((l+=s+1)>i));)s=n[a=(a+1)%n.length];return o.reverse().join(e)}),r=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?jn:function(t){return function(n){return n.replace(/[0-9]/g,(function(n){return t[+n]}))}}(Un.call(t.numerals,String)),l=void 0===t.percent?"%":t.percent+"",u=void 0===t.minus?"-":t.minus+"",h=void 0===t.nan?"NaN":t.nan+"";function c(t){var n=(t=Pn(t)).fill,e=t.align,c=t.sign,f=t.symbol,p=t.zero,d=t.width,g=t.comma,_=t.precision,m=t.trim,y=t.type;"n"===y?(g=!0,y="g"):$n[y]||(void 0===_&&(_=12),m=!0,y="g"),(p||"0"===n&&"="===e)&&(p=!0,n="0",e="=");var v="$"===f?r:"#"===f&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===f?o:/[%p]/.test(y)?l:"",b=$n[y],w=/[defgprs%]/.test(y);function k(t){var r,o,l,f=v,k=x;if("c"===y)k=b(t)+k,t="";else{var M=(t=+t)<0||1/t<0;if(t=isNaN(t)?h:b(Math.abs(t),_),m&&(t=function(t){t:for(var n,e=t.length,i=1,r=-1;i<e;++i)switch(t[i]){case".":r=n=i;break;case"0":0===r&&(r=i),n=i;break;default:if(!+t[i])break t;r>0&&(r=0)}return r>0?t.slice(0,r)+t.slice(n+1):t}(t)),M&&0==+t&&"+"!==c&&(M=!1),f=(M?"("===c?c:u:"-"===c||"("===c?"":c)+f,k=("s"===y?Xn[8+On/3]:"")+k+(M&&"("===c?")":""),w)for(r=-1,o=t.length;++r<o;)if(48>(l=t.charCodeAt(r))||l>57){k=(46===l?a+t.slice(r+1):t.slice(r))+k,t=t.slice(0,r);break}}g&&!p&&(t=i(t,1/0));var S=f.length+t.length+k.length,A=S<d?new Array(d-S+1).join(n):"";switch(g&&p&&(t=i(A+t,A.length?d-k.length:1/0),A=""),e){case"<":t=f+t+k+A;break;case"=":t=f+A+t+k;break;case"^":t=A.slice(0,S=A.length>>1)+f+t+k+A.slice(S);break;default:t=A+f+t+k}return s(t)}return _=void 0===_?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,_)):Math.max(0,Math.min(20,_)),k.toString=function(){return t+""},k}return{format:c,formatPrefix:function(t,n){var e=c(((t=Pn(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(zn(n)/3))),r=Math.pow(10,-i),o=Xn[8+i/3];return function(t){return e(r*t)+o}}}}function Wn(t,n,e,i){var r,o=function(t,n,e){var i=Math.abs(n-t)/Math.max(0,e),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),o=i/r;return o>=bt?r*=10:o>=wt?r*=5:o>=kt&&(r*=2),n<t?-r:r}(t,n,e);switch((i=Pn(null==i?",f":i)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(n));return null!=i.precision||isNaN(r=function(t,n){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(zn(n)/3)))-zn(Math.abs(t)))}(o,a))||(i.precision=r),Vn(i,a);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(r=function(t,n){return t=Math.abs(t),n=Math.abs(n)-t,Math.max(0,zn(n)-zn(t))+1}(o,Math.max(Math.abs(t),Math.abs(n))))||(i.precision=r-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(r=function(t){return Math.max(0,-zn(Math.abs(t)))}(o))||(i.precision=r-2*("%"===i.type))}return Gn(i)}function Zn(t){var n=t.domain;return t.ticks=function(t){var e=n();return function(t,n,e){var i,r,o,a,s=-1;if(e=+e,(t=+t)===(n=+n)&&e>0)return[t];if((i=n<t)&&(r=t,t=n,n=r),0===(a=Mt(t,n,e))||!isFinite(a))return[];if(a>0)for(t=Math.ceil(t/a),n=Math.floor(n/a),o=new Array(r=Math.ceil(n-t+1));++s<r;)o[s]=(t+s)*a;else for(t=Math.floor(t*a),n=Math.ceil(n*a),o=new Array(r=Math.ceil(t-n+1));++s<r;)o[s]=(t-s)/a;return i&&o.reverse(),o}(e[0],e[e.length-1],null==t?10:t)},t.tickFormat=function(t,e){var i=n();return Wn(i[0],i[i.length-1],null==t?10:t,e)},t.nice=function(e){null==e&&(e=10);var i,r=n(),o=0,a=r.length-1,s=r[o],l=r[a];return l<s&&(i=s,s=l,l=i,i=o,o=a,a=i),(i=Mt(s,l,e))>0?i=Mt(s=Math.floor(s/i)*i,l=Math.ceil(l/i)*i,e):i<0&&(i=Mt(s=Math.ceil(s*i)/i,l=Math.floor(l*i)/i,e)),i>0?(r[o]=Math.floor(s/i)*i,r[a]=Math.ceil(l/i)*i,n(r)):i<0&&(r[o]=Math.ceil(s*i)/i,r[a]=Math.floor(l*i)/i,n(r)),t},t}function Qn(){var t=Dn(Tn,Tn);return t.copy=function(){return Hn(t,Qn())},At.apply(t,arguments),Zn(t)}In=Yn({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),Gn=In.format,Vn=In.formatPrefix;var Kn={value:function(){}};function Jn(){for(var t,n=0,e=arguments.length,i={};n<e;++n){if(!(t=arguments[n]+"")||t in i||/[\s.]/.test(t))throw new Error("illegal type: "+t);i[t]=[]}return new te(i)}function te(t){this._=t}function ne(t,n){return t.trim().split(/^|\s+/).map((function(t){var e="",i=t.indexOf(".");if(i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),t&&!n.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))}function ee(t,n){for(var e,i=0,r=t.length;i<r;++i)if((e=t[i]).name===n)return e.value}function ie(t,n,e){for(var i=0,r=t.length;i<r;++i)if(t[i].name===n){t[i]=Kn,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=e&&t.push({name:n,value:e}),t}function re(){J.stopImmediatePropagation()}function oe(){J.preventDefault(),J.stopImmediatePropagation()}function ae(t){var n=t.document.documentElement,e=ct(t).on("dragstart.drag",oe,!0);"onselectstart"in n?e.on("selectstart.drag",oe,!0):(n.__noselect=n.style.MozUserSelect,n.style.MozUserSelect="none")}function se(t){return function(){return t}}function le(t,n,e,i,r,o,a,s,l,u){this.target=t,this.type=n,this.subject=e,this.identifier=i,this.active=r,this.x=o,this.y=a,this.dx=s,this.dy=l,this._=u}function ue(){return!J.ctrlKey&&!J.button}function he(){return this.parentNode}function ce(t){return null==t?{x:J.x,y:J.y}:t}function fe(){return navigator.maxTouchPoints||"ontouchstart"in this}function pe(){var t,n,e,i,r=ue,o=he,a=ce,s=fe,l={},u=Jn("start","drag","end"),h=0,c=0;function f(t){t.on("mousedown.drag",p).filter(s).on("touchstart.drag",_).on("touchmove.drag",m).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(){if(!i&&r.apply(this,arguments)){var a=v("mouse",o.apply(this,arguments),dt,this,arguments);a&&(ct(J.view).on("mousemove.drag",d,!0).on("mouseup.drag",g,!0),ae(J.view),re(),e=!1,t=J.clientX,n=J.clientY,a("start"))}}function d(){if(oe(),!e){var i=J.clientX-t,r=J.clientY-n;e=i*i+r*r>c}l.mouse("drag")}function g(){ct(J.view).on("mousemove.drag mouseup.drag",null),function(t,n){var e=t.document.documentElement,i=ct(t).on("dragstart.drag",null);n&&(i.on("click.drag",oe,!0),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in e?i.on("selectstart.drag",null):(e.style.MozUserSelect=e.__noselect,delete e.__noselect)}(J.view,e),oe(),l.mouse("end")}function _(){if(r.apply(this,arguments)){var t,n,e=J.changedTouches,i=o.apply(this,arguments),a=e.length;for(t=0;t<a;++t)(n=v(e[t].identifier,i,_t,this,arguments))&&(re(),n("start"))}}function m(){var t,n,e=J.changedTouches,i=e.length;for(t=0;t<i;++t)(n=l[e[t].identifier])&&(oe(),n("drag"))}function y(){var t,n,e=J.changedTouches,r=e.length;for(i&&clearTimeout(i),i=setTimeout((function(){i=null}),500),t=0;t<r;++t)(n=l[e[t].identifier])&&(re(),n("end"))}function v(t,n,e,i,r){var o,s,c,p=e(n,t),d=u.copy();if(ot(new le(f,"beforestart",o,t,h,p[0],p[1],0,0,d),(function(){return null!=(J.subject=o=a.apply(i,r))&&(s=o.x-p[0]||0,c=o.y-p[1]||0,!0)})))return function a(u){var g,_=p;switch(u){case"start":l[t]=a,g=h++;break;case"end":delete l[t],--h;case"drag":p=e(n,t),g=h}ot(new le(f,u,o,t,g,p[0]+s,p[1]+c,p[0]-_[0],p[1]-_[1],d),d.apply,d,[u,i,r])}}return f.filter=function(t){return arguments.length?(r="function"==typeof t?t:se(!!t),f):r},f.container=function(t){return arguments.length?(o="function"==typeof t?t:se(t),f):o},f.subject=function(t){return arguments.length?(a="function"==typeof t?t:se(t),f):a},f.touchable=function(t){return arguments.length?(s="function"==typeof t?t:se(!!t),f):s},f.on=function(){var t=u.on.apply(u,arguments);return t===u?f:t},f.clickDistance=function(t){return arguments.length?(c=(t=+t)*t,f):Math.sqrt(c)},f}te.prototype=Jn.prototype={constructor:te,on:function(t,n){var e,i=this._,r=ne(t+"",i),o=-1,a=r.length;if(!(arguments.length<2)){if(null!=n&&"function"!=typeof n)throw new Error("invalid callback: "+n);for(;++o<a;)if(e=(t=r[o]).type)i[e]=ie(i[e],t.name,n);else if(null==n)for(e in i)i[e]=ie(i[e],t.name,null);return this}for(;++o<a;)if((e=(t=r[o]).type)&&(e=ee(i[e],t.name)))return e},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new te(t)},call:function(t,n){if((e=arguments.length-2)>0)for(var e,i,r=new Array(e),o=0;o<e;++o)r[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,e=(i=this._[t]).length;o<e;++o)i[o].value.apply(n,r)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,o=i.length;r<o;++r)i[r].value.apply(n,e)}},le.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var de=Array.prototype.slice;function ge(t){return t}function _e(t){return"translate("+(t+.5)+",0)"}function me(t){return"translate(0,"+(t+.5)+")"}function ye(t){return function(n){return+t(n)}}function ve(t){var n=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(n=Math.round(n)),function(e){return+t(e)+n}}function xe(){return!this.__axis}function be(t,n){var e=[],i=null,r=null,o=6,a=6,s=3,l=1===t||4===t?-1:1,u=4===t||2===t?"x":"y",h=1===t||3===t?_e:me;function c(c){var f=null==i?n.ticks?n.ticks.apply(n,e):n.domain():i,p=null==r?n.tickFormat?n.tickFormat.apply(n,e):ge:r,d=Math.max(o,0)+s,g=n.range(),_=+g[0]+.5,m=+g[g.length-1]+.5,y=(n.bandwidth?ve:ye)(n.copy()),v=c.selection?c.selection():c,x=v.selectAll(".domain").data([null]),b=v.selectAll(".tick").data(f,n).order(),w=b.exit(),k=b.enter().append("g").attr("class","tick"),M=b.select("line"),S=b.select("text");x=x.merge(x.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),b=b.merge(k),M=M.merge(k.append("line").attr("stroke","currentColor").attr(u+"2",l*o)),S=S.merge(k.append("text").attr("fill","currentColor").attr(u,l*d).attr("dy",1===t?"0em":3===t?"0.71em":"0.32em")),c!==v&&(x=x.transition(c),b=b.transition(c),M=M.transition(c),S=S.transition(c),w=w.transition(c).attr("opacity",1e-6).attr("transform",(function(t){return isFinite(t=y(t))?h(t):this.getAttribute("transform")})),k.attr("opacity",1e-6).attr("transform",(function(t){var n=this.parentNode.__axis;return h(n&&isFinite(n=n(t))?n:y(t))}))),w.remove(),x.attr("d",4===t||2==t?a?"M"+l*a+","+_+"H0.5V"+m+"H"+l*a:"M0.5,"+_+"V"+m:a?"M"+_+","+l*a+"V0.5H"+m+"V"+l*a:"M"+_+",0.5H"+m),b.attr("opacity",1).attr("transform",(function(t){return h(y(t))})),M.attr(u+"2",l*o),S.attr(u,l*d).text(p),v.filter(xe).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===t?"start":4===t?"end":"middle"),v.each((function(){this.__axis=y}))}return c.scale=function(t){return arguments.length?(n=t,c):n},c.ticks=function(){return e=de.call(arguments),c},c.tickArguments=function(t){return arguments.length?(e=null==t?[]:de.call(t),c):e.slice()},c.tickValues=function(t){return arguments.length?(i=null==t?null:de.call(t),c):i&&i.slice()},c.tickFormat=function(t){return arguments.length?(r=t,c):r},c.tickSize=function(t){return arguments.length?(o=a=+t,c):o},c.tickSizeInner=function(t){return arguments.length?(o=+t,c):o},c.tickSizeOuter=function(t){return arguments.length?(a=+t,c):a},c.tickPadding=function(t){return arguments.length?(s=+t,c):s},c}function we(t){return be(3,t)}function ke(t){return be(4,t)}var Me=Math.PI,Se=2*Me,Ae=Se-1e-6;function Te(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Ee(){return new Te}function Ne(t){return function(){return t}}Te.prototype=Ee.prototype={constructor:Te,moveTo:function(t,n){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+n)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,n){this._+="L"+(this._x1=+t)+","+(this._y1=+n)},quadraticCurveTo:function(t,n,e,i){this._+="Q"+ +t+","+ +n+","+(this._x1=+e)+","+(this._y1=+i)},bezierCurveTo:function(t,n,e,i,r,o){this._+="C"+ +t+","+ +n+","+ +e+","+ +i+","+(this._x1=+r)+","+(this._y1=+o)},arcTo:function(t,n,e,i,r){t=+t,n=+n,e=+e,i=+i,r=+r;var o=this._x1,a=this._y1,s=e-t,l=i-n,u=o-t,h=a-n,c=u*u+h*h;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=n);else if(c>1e-6)if(Math.abs(h*s-l*u)>1e-6&&r){var f=e-o,p=i-a,d=s*s+l*l,g=f*f+p*p,_=Math.sqrt(d),m=Math.sqrt(c),y=r*Math.tan((Me-Math.acos((d+c-g)/(2*_*m)))/2),v=y/m,x=y/_;Math.abs(v-1)>1e-6&&(this._+="L"+(t+v*u)+","+(n+v*h)),this._+="A"+r+","+r+",0,0,"+ +(h*f>u*p)+","+(this._x1=t+x*s)+","+(this._y1=n+x*l)}else this._+="L"+(this._x1=t)+","+(this._y1=n);else;},arc:function(t,n,e,i,r,o){t=+t,n=+n,o=!!o;var a=(e=+e)*Math.cos(i),s=e*Math.sin(i),l=t+a,u=n+s,h=1^o,c=o?i-r:r-i;if(e<0)throw new Error("negative radius: "+e);null===this._x1?this._+="M"+l+","+u:(Math.abs(this._x1-l)>1e-6||Math.abs(this._y1-u)>1e-6)&&(this._+="L"+l+","+u),e&&(c<0&&(c=c%Se+Se),c>Ae?this._+="A"+e+","+e+",0,1,"+h+","+(t-a)+","+(n-s)+"A"+e+","+e+",0,1,"+h+","+(this._x1=l)+","+(this._y1=u):c>1e-6&&(this._+="A"+e+","+e+",0,"+ +(c>=Me)+","+h+","+(this._x1=t+e*Math.cos(r))+","+(this._y1=n+e*Math.sin(r))))},rect:function(t,n,e,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+n)+"h"+ +e+"v"+ +i+"h"+-e+"Z"},toString:function(){return this._}};var Ce=Math.PI,Le=2*Ce;function He(t){this._context=t}function De(t){return new He(t)}function Fe(t){return t[0]}function ze(t){return t[1]}function Oe(){var t=Fe,n=ze,e=Ne(!0),i=null,r=De,o=null;function a(a){var s,l,u,h=a.length,c=!1;for(null==i&&(o=r(u=Ee())),s=0;s<=h;++s)!(s<h&&e(l=a[s],s,a))===c&&((c=!c)?o.lineStart():o.lineEnd()),c&&o.point(+t(l,s,a),+n(l,s,a));if(u)return o=null,u+""||null}return a.x=function(n){return arguments.length?(t="function"==typeof n?n:Ne(+n),a):t},a.y=function(t){return arguments.length?(n="function"==typeof t?t:Ne(+t),a):n},a.defined=function(t){return arguments.length?(e="function"==typeof t?t:Ne(!!t),a):e},a.curve=function(t){return arguments.length?(r=t,null!=i&&(o=r(i)),a):r},a.context=function(t){return arguments.length?(null==t?i=o=null:o=r(i=t),a):i},a}He.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;default:this._context.lineTo(t,n)}}};var Be={draw:function(t,n){var e=Math.sqrt(n/Ce);t.moveTo(e,0),t.arc(0,0,e,0,Le)}},Pe=Math.sqrt(3),Re={draw:function(t,n){var e=-Math.sqrt(n/(3*Pe));t.moveTo(0,2*e),t.lineTo(-Pe*e,-e),t.lineTo(Pe*e,-e),t.closePath()}};function qe(){var t=Ne(Be),n=Ne(64),e=null;function i(){var i;if(e||(e=i=Ee()),t.apply(this,arguments).draw(e,+n.apply(this,arguments)),i)return e=null,i+""||null}return i.type=function(n){return arguments.length?(t="function"==typeof n?n:Ne(n),i):t},i.size=function(t){return arguments.length?(n="function"==typeof t?t:Ne(+t),i):n},i.context=function(t){return arguments.length?(e=null==t?null:t,i):e},i}function $e(t,n,e){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+n)/6,(t._y0+4*t._y1+e)/6)}function je(t){this._context=t}function Ie(t){return new je(t)}function Ge(t){for(var n=t.length/6|0,e=new Array(n),i=0;i<n;)e[i]="#"+t.slice(6*i,6*++i);return e}je.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:$e(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:$e(this,t,n)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n}};var Ve=Ge("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),Ue=Ge("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),Xe=Ge("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),Ye=Ge("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),We=Ge("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),Ze=Ge("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f");!function(n,e){"function"==typeof define&&define.amd?define(["leaflet"],n):"object"===("undefined"==typeof exports?"undefined":t(exports))&&(void 0!==e&&e.L?module.exports=n(L):module.exports=n(require("leaflet"))),void 0!==e&&e.L&&(e.L.Control.Heightgraph=n(L))}((function(t){return t.Control.Heightgraph=t.Control.extend({options:{position:"bottomright",width:800,height:280,margins:{top:10,right:30,bottom:55,left:50},mappings:void 0,expand:!0,translation:{},expandCallback:void 0,xTicks:void 0,yTicks:void 0,highlightStyle:void 0},_defaultTranslation:{distance:"Distance",elevation:"Elevation",segment_length:"Segment length",type:"Type",legend:"Legend"},_init_options:function(){this._margin=this.options.margins,this._width=this.options.width,this._height=this.options.height,this._mappings=this.options.mappings,this._svgWidth=this._width-this._margin.left-this._margin.right,this._svgHeight=this._height-this._margin.top-this._margin.bottom,this._selectedOption=0,this._highlightStyle=this.options.highlightStyle||{color:"red"}},onAdd:function(n){var e=this._container=t.DomUtil.create("div","heightgraph");t.DomEvent.disableClickPropagation(e);var i=this._button=t.DomUtil.create("div","heightgraph-toggle",e);t.DomUtil.create("a","heightgraph-toggle-icon",i),this._closeButton=t.DomUtil.create("a","heightgraph-close-icon",e);this._showState=!1,this._initToggle(),this._init_options();this._svg=ct(this._container).append("svg").attr("class","heightgraph-container").attr("width",this._svgWidth+this._margin.left+this._margin.right).attr("height",this._svgHeight+this._margin.top+this._margin.bottom).append("g").attr("transform","translate("+this._margin.left+","+this._margin.top+")");return e},onRemove:function(t){this._removeMarkedSegmentsOnMap(),this._container=null,this._svg=void 0},addData:function(t){void 0!==this._svg&&this._svg.selectAll("*").remove(),this._data=t,this._init_options(),this._prepareData(),this._computeStats(),this._appendScales(),this._appendGrid(),this._createChart(this._selectedOption),this._data.length>1&&this._createSelectionBox(),this.options.expand&&this._expand()},_initToggle:function(){t.Browser.touch?t.DomEvent.on(this._container,"click",t.DomEvent.stopPropagation):t.DomEvent.disableClickPropagation(this._container),t.DomEvent.on(this._button,"click",this._expand,this),t.DomEvent.on(this._closeButton,"click",this._expand,this)},_dragHandler:function(){event.preventDefault(),event.stopPropagation(),this._gotDragged=!0,this._drawDragRectangle()},_drawDragRectangle:function(){if(this._dragStartCoords){var t=this._dragCurrentCoords=dt(this._background.node()),n=Math.min(this._dragStartCoords[0],t[0]),e=Math.max(this._dragStartCoords[0],t[0]);if(this._dragRectangle||this._dragRectangleG)this._dragRectangle.attr("width",e-n).attr("x",n);else{var i=ct(this._container).select("svg").select("g");this._dragRectangleG=i.append("g"),this._dragRectangle=this._dragRectangleG.append("rect").attr("width",e-n).attr("height",this._svgHeight).attr("x",n).attr("class","mouse-drag").style("fill","grey").style("opacity",.5).style("pointer-events","none")}}},_resetDrag:function(){this._dragRectangleG&&(this._dragRectangleG.remove(),this._dragRectangleG=null,this._dragRectangle=null)},_dragEndHandler:function(){if(!this._dragStartCoords||!this._gotDragged)return this._dragStartCoords=null,this._gotDragged=!1,void this._resetDrag();var t=this._findItemForX(this._dragStartCoords[0]),n=this._findItemForX(this._dragCurrentCoords[0]);this._fitSection(t,n),this._dragStartCoords=null,this._gotDragged=!1},_dragStartHandler:function(){event.preventDefault(),event.stopPropagation(),this._gotDragged=!1,this._dragStartCoords=dt(this._background.node())},_calculateFullExtent:function(n){if(!n||n.length<1)throw new Error("no data in parameters");var e=new t.latLngBounds(n[0].latlng,n[0].latlng);return n.forEach((function(t){e.contains(t.latlng)||e.extend(t.latlng)})),e},_fitSection:function(t,n){var e,i=Math.min(t,n),r=Math.max(t,n);e=i!==r?this._calculateFullExtent(this._areasFlattended.slice(i,r+1)):[this._areasFlattended[i].latlng,this._areasFlattended[r].latlng],this._map.fitBounds(e)},_expand:function(){this._showState?(ct(this._button).style("display","block"),ct(this._container).selectAll("svg").style("display","none"),ct(this._closeButton).style("display","none")):(ct(this._button).style("display","none"),ct(this._container).selectAll("svg").style("display","block"),ct(this._closeButton).style("display","block")),this._showState=!this._showState,"function"==typeof this.options.expandCallback&&this.options.expandCallback(this._showState)},_removeChart:function(){void 0!==this._svg&&(this._svg.selectAll("path.area").remove(),this._svg.selectAll("path.border-top").remove(),this._svg.selectAll(".legend").remove(),this._svg.selectAll(".lineSelection").remove(),this._svg.selectAll(".horizontalLine").remove(),this._svg.selectAll(".horizontalLineText").remove())},_randomNumber:function(t){return Math.round(Math.random()*(t-0))},_d3ColorCategorical:[Ue,Xe,We,Ve,Ze,Ye],_prepareData:function(){this._profile={},this._profile.coordinates=[],this._profile.elevations=[],this._profile.cumDistances=[],this._profile.cumDistances.push(0),this._profile.blocks=[];var n,e=this._data;if(void 0===this._mappings){var i=this._randomNumber(this._d3ColorCategorical.length-1);n=function t(){var n=Et(),e=[],i=[],r=Ft;function o(t){var o=t+"",a=n.get(o);if(!a){if(r!==Ft)return r;n.set(o,a=e.push(t))}return i[(a-1)%i.length]}return o.domain=function(t){if(!arguments.length)return e.slice();e=[],n=Et();for(var i,r,a=-1,s=t.length;++a<s;)n.has(r=(i=t[a])+"")||n.set(r,e.push(i));return o},o.range=function(t){return arguments.length?(i=Dt.call(t),o):i.slice()},o.unknown=function(t){return arguments.length?(r=t,o):r},o.copy=function(){return t(e,i).unknown(r)},At.apply(o,arguments),o}(this._d3ColorCategorical[i])}for(var r=0;r<e.length;r++){var o=0;this._profile.blocks[r]={},this._profile.blocks[r].info={id:r,text:e[r].properties.summary},this._profile.blocks[r].distances=[],this._profile.blocks[r].attributes=[],this._profile.blocks[r].geometries=[],this._profile.blocks[r].legend={};var a=void 0,s=0,l={};for(a=0;a<e[r].features.length;a++){var u=void 0,h=void 0,c=void 0,f=[],p=e[r].features[a].geometry.coordinates.length,d=e[r].features[a].properties.attributeType,g=void 0,_=void 0;void 0===this._mappings?d in l?(g=d,_=l[d]):(g=d,_=n(a),l[d]=_):(g=this._mappings[e[r].properties.summary][d].text,_=this._mappings[e[r].properties.summary][d].color);var m={type:d,text:g,color:_};this._profile.blocks[r].attributes.push(m),d in this._profile.blocks[r].legend||(this._profile.blocks[r].legend[d]=m);for(var y=0;y<p;y++){h=new t.LatLng(e[r].features[a].geometry.coordinates[y][1],e[r].features[a].geometry.coordinates[y][0]),u=e[r].features[a].geometry.coordinates[y][2],y<p-1?(c=new t.LatLng(e[r].features[a].geometry.coordinates[y+1][1],e[r].features[a].geometry.coordinates[y+1][0]),o+=h.distanceTo(c)/1e3,0===r&&(this._profile.elevations.push(u),this._profile.coordinates.push(h),this._profile.cumDistances.push(o)),s+=1):y===p-1&&a===e[r].features.length-1&&(0===r&&(this._profile.elevations.push(u),this._profile.coordinates.push(c)),s+=1);var v=void 0;v=y===p-1&&a<e[r].features.length-1?this._profile.cumDistances[s]:this._profile.cumDistances[s-1],f.push({altitude:u,position:v,x:h.lng,y:h.lat,latlng:h,type:g,areaIdx:a})}this._profile.blocks[r].distances.push(o),this._profile.blocks[r].geometries.push(f)}r===e.length-1&&(this._profile.totalDistance=o)}},_computeStats:function(){var t=this._profile.maxElevation=St(this._profile.elevations),n=this._profile.minElevation=function(t,n){var e,i,r=t.length,o=-1;if(null==n){for(;++o<r;)if(null!=(e=t[o])&&e>=e)for(i=e;++o<r;)null!=(e=t[o])&&i>e&&(i=e)}else for(;++o<r;)if(null!=(e=n(t[o],o,t))&&e>=e)for(i=e;++o<r;)null!=(e=n(t[o],o,t))&&i>e&&(i=e);return i}(this._profile.elevations),e=this._profile.elevationQuantile=function(t,n,e){if(null==e&&(e=xt),i=t.length){if((n=+n)<=0||i<2)return+e(t[0],0,t);if(n>=1)return+e(t[i-1],i-1,t);var i,r=(i-1)*n,o=Math.floor(r),a=+e(t[o],o,t);return a+(+e(t[o+1],o+1,t)-a)*(r-o)}}(this._profile.elevations,.75);this._profile.yElevationMin=e<n+n/10?n-t/5<0?0:n-t/5:n-t/10,this._profile.yElevationMax=e>t-t/10?t+t/3:t},_showMarker:function(t,n,e){var i=this._map.latLngToLayerPoint(t),r=i.y-75;if(!this._mouseHeightFocus){var o=ct(".leaflet-overlay-pane svg").append("g");this._mouseHeightFocus=o.append("svg:line").attr("class","height-focus line").attr("x2","0").attr("y2","0").attr("x1","0").attr("y1","0"),this._mouseHeightFocusLabel=o.append("g").attr("class","height-focus label"),this._mouseHeightFocusLabelRect=this._mouseHeightFocusLabel.append("rect").attr("class","bBox"),this._mouseHeightFocusLabelTextElev=this._mouseHeightFocusLabel.append("text").attr("class","tspan"),this._mouseHeightFocusLabelTextType=this._mouseHeightFocusLabel.append("text").attr("class","tspan"),(this._pointG=o.append("g").attr("class","height-focus circle")).append("svg:circle").attr("r",5).attr("cx",0).attr("cy",0).attr("class","height-focus circle-lower")}this._mouseHeightFocusLabel.style("display","block"),this._mouseHeightFocus.attr("x1",i.x).attr("x2",i.x).attr("y1",i.y).attr("y2",r).style("display","block"),this._pointG.attr("transform","translate("+i.x+","+i.y+")").style("display","block"),this._mouseHeightFocusLabelRect.attr("x",i.x+3).attr("y",r).attr("class","bBox"),this._mouseHeightFocusLabelTextElev.attr("x",i.x+5).attr("y",r+12).text(n+" m").attr("class","tspan mouse-height-box-text"),this._mouseHeightFocusLabelTextType.attr("x",i.x+5).attr("y",r+24).text(e).attr("class","tspan mouse-height-box-text");var a=this._dynamicBoxSize("text.tspan")[1],s=""===e?18:30;gt(".bBox").attr("width",a+10).attr("height",s)},_createChart:function(t){var n=this._profile.blocks[t].geometries;this._areasFlattended=[].concat.apply([],n);for(var e=0;e<n.length;e++)this._appendAreas(n[e],t,e);this._createFocus(),this._appendBackground(),this._createBorderTopLine(),this._createLegend(),this._createHorizontalLine()},_createFocus:function(){var t=this._profile.yElevationMin;this._focus&&(this._focus.remove(),this._focusLineGroup.remove()),this._focus=this._svg.append("g").attr("class","focusbox"),this._focusRect=this._focus.append("rect").attr("x",3).attr("y",-this._y(t)).attr("display","none"),this._focusDistance=this._focus.append("text").attr("x",7).attr("y",15-this._y(t)).attr("id","distance").text(this._getTranslation("distance")+":"),this._focusHeight=this._focus.append("text").attr("x",7).attr("y",30-this._y(t)).attr("id","height").text(this._getTranslation("elevation")+":"),this._focusBlockDistance=this._focus.append("text").attr("x",7).attr("y",45-this._y(t)).attr("id","blockdistance").text(this._getTranslation("segment_length")+":"),this._focusType=this._focus.append("text").attr("x",7).attr("y",60-this._y(t)).attr("id","type").text(this._getTranslation("type")+":"),this._areaTspan=this._focusBlockDistance.append("tspan").attr("class","tspan"),this._typeTspan=this._focusType.append("tspan").attr("class","tspan");var n=this._dynamicBoxSize(".focusbox text")[0];gt(".focusbox rect").attr("height",15*n+7.5).attr("display","block"),this._focusLineGroup=this._svg.append("g").attr("class","focusLine"),this._focusLine=this._focusLineGroup.append("line").attr("y1",0).attr("y2",this._y(this._profile.yElevationMin)),this._distTspan=this._focusDistance.append("tspan").attr("class","tspan"),this._altTspan=this._focusHeight.append("tspan").attr("class","tspan")},_createHorizontalLine:function(){var t=this;this._horizontalLine=this._svg.append("line").attr("class","horizontalLine").attr("x1",0).attr("x2",this._width-this._margin.left-this._margin.right).attr("y1",this._y(this._profile.yElevationMin)).attr("y2",this._y(this._profile.yElevationMin)).style("stroke","black"),this._elevationValueText=this._svg.append("text").attr("class","horizontalLineText").attr("x",this._width-this._margin.left-this._margin.right-20).attr("y",this._y(this._profile.yElevationMin)-10).attr("fill","black");var n=[{x:this._width-this._margin.left-this._margin.right+7,y:this._y(this._profile.yElevationMin),color:"black",type:Re,angle:-90,size:100}];this._svg.selectAll(".horizontal-symbol").data(n).enter().append("path").attr("class","lineSelection").attr("d",qe().type((function(t){return t.type})).size((function(t){return t.size}))).attr("transform",(function(t){return"translate("+t.x+","+t.y+") rotate("+t.angle+")"})).attr("id",(function(t){return t.id})).style("fill",(function(t){return t.color})).call(pe().on("start",(function(t){ct(this).raise().classed("active",!0),ct(".horizontalLine").raise().classed("active",!0)})).on("drag",(function(n){var e=t._svgHeight,i=dt(t._container)[1]-10;ct(this).attr("transform",(function(t){return"translate("+t.x+","+(i<0?0:i>e?e:i)+") rotate("+t.angle+")"})),ct(".horizontalLine").attr("y1",i<0?0:i>e?e:i).attr("y2",i<0?0:i>e?e:i),t._highlightedCoords=i>=e?[]:t._findCoordsForY(i),ct(".horizontalLineText").attr("y",i<=10?0:i>e?e-10:i-10).text(Gn(".0f")(t._y.invert(i<0?0:i>e?e:i))+" m"),t._removeMarkedSegmentsOnMap(),t._markSegmentsOnMap(t._highlightedCoords)})).on("end",(function(n){ct(this).classed("active",!1),ct(".horizontalLine").classed("active",!1),t._removeMarkedSegmentsOnMap(),t._markSegmentsOnMap(t._highlightedCoords)})))},_markSegmentsOnMap:function(n){if(n)if(n.length>1){this._markedSegments=t.featureGroup();var i,r=e(n);try{for(r.s();!(i=r.n()).done;){var o=i.value;t.polyline(o,this._highlightStyle).addTo(this._markedSegments)}}catch(t){r.e(t)}finally{r.f()}this._markedSegments.addTo(this._map).bringToFront()}else this._markedSegments=t.polyline(n,this._highlightStyle).addTo(this._map)},_removeMarkedSegmentsOnMap:function(){void 0!==this._markedSegments&&this._map.removeLayer(this._markedSegments)},_appendScales:function(){var t,n=Boolean(this._profile.totalDistance<=10),e=this._profile.yElevationMin,i=this._profile.yElevationMax,r=(this._margin,this._width-this._margin.left-this._margin.right),o=this._height-this._margin.top-this._margin.bottom;this._x=Qn().range([0,r]),this._y=Qn().range([o,0]),this._x.domain([0,this._profile.totalDistance]),this._y.domain([e,i]),this._xAxis=!0===n?we().scale(this._x).tickFormat((function(t){return Gn(".2f")(t)+" km"})):we().scale(this._x).tickFormat((function(t){return Gn(".0f")(t)+" km"})),void 0!==this.options.xTicks&&this._xAxis.ticks(Math.pow(2,this.options.xTicks)),this._yAxis=ke().scale(this._y).tickFormat((function(t){return t+" m"})),void 0!==this.options.yTicks&&this._yAxis.ticks(Math.pow(2,this.options.yTicks)),this._yEndAxis=be(2,t).scale(this._yEnd).ticks(0)},_appendBackground:function(){var n=this._background=ct(this._container).select("svg").select("g").append("rect").attr("width",this._svgWidth).attr("height",this._svgHeight).style("fill","none").style("stroke","none").style("pointer-events","all").on("mousemove.focusbox",this._mousemoveHandler.bind(this)).on("mouseout.focusbox",this._mouseoutHandler.bind(this));t.Browser.android?(n.on("touchstart.drag",this._dragHandler.bind(this)).on("touchstart.drag",this._dragStartHandler.bind(this)).on("touchstart.focusbox",this._mousemoveHandler.bind(this)),t.DomEvent.on(this._container,"touchend",this._dragEndHandler,this)):(n.on("mousemove.focusbox",this._mousemoveHandler.bind(this)).on("mouseout.focusbox",this._mouseoutHandler.bind(this)).on("mousedown.drag",this._dragStartHandler.bind(this)).on("mousemove.drag",this._dragHandler.bind(this)),t.DomEvent.on(this._container,"mouseup",this._dragEndHandler,this))},_appendGrid:function(){this._svg.append("g").attr("class","grid").attr("transform","translate(0,"+this._svgHeight+")").call(this._make_x_axis().tickSize(-this._svgHeight,0,0).tickFormat("")),this._svg.append("g").attr("class","grid").call(this._make_y_axis().tickSize(-this._svgWidth,0,0).ticks(5).tickFormat("")),this._svg.append("g").attr("transform","translate(0,"+this._svgHeight+")").attr("class","x axis").call(this._xAxis),this._svg.append("g").attr("transform","translate(-2,0)").attr("class","y axis").call(this._yAxis)},_appendAreas:function(t,n,e){var i=this._profile.blocks[n].attributes[e].color,r=this;this._area=function(){var t=Fe,n=null,e=Ne(0),i=ze,r=Ne(!0),o=null,a=De,s=null;function l(l){var u,h,c,f,p,d=l.length,g=!1,_=new Array(d),m=new Array(d);for(null==o&&(s=a(p=Ee())),u=0;u<=d;++u){if(!(u<d&&r(f=l[u],u,l))===g)if(g=!g)h=u,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),c=u-1;c>=h;--c)s.point(_[c],m[c]);s.lineEnd(),s.areaEnd()}g&&(_[u]=+t(f,u,l),m[u]=+e(f,u,l),s.point(n?+n(f,u,l):_[u],i?+i(f,u,l):m[u]))}if(p)return s=null,p+""||null}function u(){return Oe().defined(r).curve(a).context(o)}return l.x=function(e){return arguments.length?(t="function"==typeof e?e:Ne(+e),n=null,l):t},l.x0=function(n){return arguments.length?(t="function"==typeof n?n:Ne(+n),l):t},l.x1=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:Ne(+t),l):n},l.y=function(t){return arguments.length?(e="function"==typeof t?t:Ne(+t),i=null,l):e},l.y0=function(t){return arguments.length?(e="function"==typeof t?t:Ne(+t),l):e},l.y1=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:Ne(+t),l):i},l.lineX0=l.lineY0=function(){return u().x(t).y(e)},l.lineY1=function(){return u().x(t).y(i)},l.lineX1=function(){return u().x(n).y(e)},l.defined=function(t){return arguments.length?(r="function"==typeof t?t:Ne(!!t),l):r},l.curve=function(t){return arguments.length?(a=t,null!=o&&(s=a(o)),l):a},l.context=function(t){return arguments.length?(null==t?o=s=null:s=a(o=t),l):o},l}().x((function(t){var n=r._x(t.position);return t.xDiagonalCoordinate=n,n})).y0(this._svgHeight).y1((function(t){return r._y(t.altitude)})).curve(De);this._areapath=this._svg.append("path").attr("class","area"),this._areapath.datum(t).attr("d",this._area).attr("stroke",i).style("fill",i).style("pointer-events","none")},_make_x_axis:function(){return we().scale(this._x)},_make_y_axis:function(){return ke().scale(this._y)},_createSelectionBox:function(){var t=this,n=ct(this._container).select("svg"),e=(this._margin,this._width-this._margin.left-this._margin.right),i=this._height-this._margin.top-this._margin.bottom,r=[{x:e-50,y:i+48,color:"#000",type:Re,id:"leftArrowSelection",angle:-360},{x:e-35,y:i+45,color:"#000",type:Re,id:"rightArrowSelection",angle:180}],o=(n.selectAll(".select-symbol").data(r).enter().append("path").attr("class","select-symbol").attr("d",qe().type((function(t){return t.type}))).attr("transform",(function(t){return"translate("+t.x+","+t.y+") rotate("+t.angle+")"})).attr("id",(function(t){return t.id})).style("fill",(function(t){return t.color})).on("click",(function(t){"rightArrowSelection"===t.id&&s(),"leftArrowSelection"===t.id&&l()})),function(r){var o=[{selection:t._profile.blocks[r].info.text}];t._selectionText&&t._selectionText.remove(),t._selectionText=n.selectAll("selection_text").data(o).enter().append("text").attr("x",e-20).attr("y",i+50).text((function(t){return t.selection})).attr("class","select-info").attr("id","selectionText")}),a=(this._profile.blocks.length,this._selectedOption);o(a);var s=function(){var n=t._selectedOption+=1;n===t._profile.blocks.length&&(t._selectedOption=n=0),o(n),t._removeChart(),t._removeMarkedSegmentsOnMap(),t._createChart(n)},l=function(){var n=t._selectedOption-=1;-1===n&&(t._selectedOption=n=t._profile.blocks.length-1),o(n),t._removeChart(),t._removeMarkedSegmentsOnMap(),t._createChart(n)}},_createLegend:function(){var t=this,n=[];for(var e in this._profile.blocks[this._selectedOption].legend)n.push(this._profile.blocks[this._selectedOption].legend[e]);this._margin,this._width,this._margin.left,this._margin.right;var i=this._height-this._margin.top-this._margin.bottom,r=[{text:this._getTranslation("legend")}],o=this._svg.selectAll(".hlegend-hover").data(n).enter().append("g").attr("class","legend").style("display","none").attr("transform",(function(t,n){return"translate(-8,"+(14*n-28)+")"}));o.append("rect").attr("class","legend-rect").attr("x",15).attr("y",36).attr("width",6).style("stroke","black").attr("height",6).style("fill",(function(t,n){return t.color})),o.append("text").attr("class","legend-text").attr("x",30).attr("y",42).text((function(n,e){var r=n.text;return t._boxBoundY=(i-2*i/3+7)*e,r})),this._svg.selectAll(".legend-hover").data(r).enter().append("g").attr("class","legend-hover").append("text").attr("class","legend-menu").attr("class","no-select").attr("x",15).attr("y",i+40).text((function(t,n){return t.text})).on("mouseover",(function(){ct(".legend-box").style("display","block"),gt(".legend").style("display","block")})).on("mouseleave",(function(){ct(".legend-box").style("display","none"),gt(".legend").style("display","none")}))},_dynamicBoxSize:function(t){for(var n=gt(t).nodes().length,e=[],i=0;i<n;i++)e.push(gt(t).nodes()[i].getBoundingClientRect().width);return[n,St(e)]},_createBorderTopLine:function(){var t=this,n=this._areasFlattended,e=Oe().x((function(n){return(0,t._x)(n.position)})).y((function(n){return(0,t._y)(n.altitude)})).curve(Ie);this._svg.append("svg:path").attr("d",e(n)).attr("class","border-top")},_mouseoutHandler:function(){for(var t=0,n=["_focusLine","_focus","_pointG","_mouseHeightFocus","_mouseHeightFocusLabel"];t<n.length;t++){var e=n[t];this[e]&&this[e].style("display","none")}},_mousemoveHandler:function(t,n,e){var i,r=dt(this._svg.node()),o=this._areasFlattended[this._findItemForX(r[0])],a=o.altitude,s=o.position,l=o.latlng,u=o.areaIdx,h=o.type,c=this._dynamicBoxSize(".focusbox text")[1]+10;i=0===u?this._profile.blocks[this._selectedOption].distances[u]:this._profile.blocks[this._selectedOption].distances[u]-this._profile.blocks[this._selectedOption].distances[u-1],this._showMarker(l,a,h),this._distTspan.text(" "+s.toFixed(1)+" km"),this._altTspan.text(" "+a+" m"),this._areaTspan.text(" "+i.toFixed(1)+" km"),this._typeTspan.text(" "+h),this._focusRect.attr("width",c),this._focusLine.style("display","block").attr("x1",this._x(s)).attr("x2",this._x(s));var f=this._x(s)-(c+5),p=this._width-this._margin.left-this._margin.right;this._x(s)+c<p&&this._focus.style("display","initial").attr("transform","translate("+this._x(s)+","+this._y(this._profile.yElevationMin)+")"),this._x(s)+c>p&&this._focus.style("display","initial").attr("transform","translate("+f+","+this._y(this._profile.yElevationMin)+")")},_findItemForX:function(t){var n=yt((function(t){return t.position})).left,e=this._x.invert(t);return n(this._areasFlattended,e)},_findCoordsForY:function(t){var n=this._y.invert(t);return function(t,n){for(var e=[],i=0;i<t.length;i++)t[i].altitude>=n&&e.push(i);for(var r=[],o=0,a=0;a<e.length-1;a++)e[a+1]!==e[a]+1&&(r.push(e.slice(o,a+1)),o=a+1);r.push(e.slice(o,e.length));for(var s=0;s<r.length;s++)for(var l=0;l<r[s].length;l++)r[s][l]=t[r[s][l]].latlng;return r}(this._areasFlattended,n)},_getTranslation:function(t){return this.options.translation[t]?this.options.translation[t]:this._defaultTranslation[t]?this._defaultTranslation[t]:(console.error("Unexpected error when looking up the translation for "+t),"No translation found")}}),t.control.heightgraph=function(n){return new t.Control.Heightgraph(n)},t.Control.Heightgraph}),window)}();
